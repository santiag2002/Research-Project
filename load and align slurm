#!/bin/bash
#SBATCH --account=def-mcfarlas
#SBATCH --time=48:00:00
#SBATCH --cpus-per-task=4
#SBATCH --mem=16G
#SBATCH --job-name=load_and_align
#SBATCH --output=load_and_align.out
#SBATCH --error=load_and_align.err

cd $SCRATCH/Research_Project/Pipeline_dev

# Load required modules
module load StdEnv/2023
module load nextflow/24.04.4

# Print Nextflow version for debugging
nextflow -version

echo "Starting pipeline: $(date)"

# Run the Nextflow pipeline
# Cleanup is handled by nextflow.config and workflow.onComplete
NXF_ANSI_LOG=false nextflow run main.nf \
    -profile modules \
    -resume \
    -with-report \
    -with-timeline \
    -with-trace

echo "Pipeline finished: $(date)"
echo "Exit code: $?"
